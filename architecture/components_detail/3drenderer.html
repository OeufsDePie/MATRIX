

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.3.5. 3D Rendering Module &mdash; MATRIX 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="MATRIX 0.1 documentation" href="../../index.html"/>
        <link rel="up" title="3.3. Components implementation" href="../components_detail.html"/>
        <link rel="next" title="4. Code Documentation" href="../../code.html"/>
        <link rel="prev" title="3.3.4. Reconstruction Manager" href="reconstruction_manager.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> MATRIX</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../context.html">1. Context and Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user.html">2. Use of the Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user/workspaces.html">2.1. Managing workspaces and scenes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/photos.html">2.2. Managing the photo selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/camera.html">2.3. Camera connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/3d.html">2.4. 3D Reconstruction and Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/map.html">2.5. Map localization</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../architecture.html">3. Architecture of the Application</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../components_global.html">3.1. Global architecture of the application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model_view.html">3.2. The model / view pattern</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../components_detail.html">3.3. Components implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">4. Code Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../code/modules.html">4.1. MatrixGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code/Python/modules.html">4.2. Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code/PyQt/modules.html">4.3. PyQt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../doc.html">5. Building that Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../doc.html#sphinx-installation">5.1. Sphinx Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc.html#initialize-the-documentation">5.2. Initialize the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc.html#configuration-of-sphinx-documentation">5.3. Configuration of Sphinx documentation</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">MATRIX</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../architecture.html">3. Architecture of the Application</a> &raquo;</li>
      
          <li><a href="../components_detail.html">3.3. Components implementation</a> &raquo;</li>
      
    <li>3.3.5. 3D Rendering Module</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/architecture/components_detail/3drenderer.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="d-rendering-module">
<h1>3.3.5. 3D Rendering Module<a class="headerlink" href="#d-rendering-module" title="Permalink to this headline">¶</a></h1>
<p>The 3D renderer is C++ module that has to be compile as a QML plugin
to be used in the application. The communication between the module
and the orchestrator can only be made through QML. To display openGL
under QML, we used the QML <a class="reference external" href="http://doc.qt.io/qt-5/qtquick-scenegraph-openglunderqml-example.html">scene graph</a>.</p>
<div class="section" id="opengl-implementation-and-ply-reader">
<h2>3.3.5.1. openGL implementation and <code class="docutils literal"><span class="pre">.ply</span></code> reader<a class="headerlink" href="#opengl-implementation-and-ply-reader" title="Permalink to this headline">¶</a></h2>
<p>The C++ code for the openGL implementation is based on this <a class="reference external" href="https://www.opengl.org/wiki/Tutorial2:_VAOs,_VBOs,_Vertex_and_Fragment_Shaders_%28C_/_SDL%29">tutorial</a>
. There are many differences as we had to use this module in a Qt
context : we had to convert every C++ openGL function in Qt openGL
functions.</p>
<p>Those are really often the same function, only the name changes. Only
<a class="reference external" href="doc.qt.io/qt-5/qopenglbuffer.html">Buffer Object</a> and <a class="reference external" href="http://doc.qt.io/qt-5/qopenglvertexarrayobject.html">Vertex Array Object</a> are different since they
are Qt object that we have to create before using them.</p>
<p>The <code class="docutils literal"><span class="pre">.ply</span></code> reader can be found in an old commit made in the <a class="reference external" href="https://github.com/openMVG/openMVG/">openMVG
repository</a>. This reader is the one initializing the position and
color buffers of the renderer.</p>
<p>When a point cloud has been read by the reader, we initialize a list
of camera coordinates simply by reading the end of the position buffer
(because cameras are found at the end of the ply file). We then
initialize the default camera to the first camera : that&#8217;s the default
point of view used for the renderer. We can switch this point of view,
in the camera list order, simply by calling the <code class="docutils literal"><span class="pre">nextCam</span></code> function.
The renderer is still pretty basic, but what is interesting here is
the conversion between the C++ openGL implementation to a Qt
implementation. We then describe how to use this renderer as a QML
plugin. The <code class="docutils literal"><span class="pre">pathply</span></code> attribute and the <code class="docutils literal"><span class="pre">nextCam</span></code> function are two
good examples of interactions between QML and the plugin, and are two
ways of communicating (by setting attributes directly from QML, or by
calling a C++ function also directly from QML).</p>
</div>
<div class="section" id="the-qml-plugin">
<h2>3.3.5.2. The QML Plugin<a class="headerlink" href="#the-qml-plugin" title="Permalink to this headline">¶</a></h2>
<p>To create a new QML plugin, we followed the QT <a class="reference external" href="http://developer.ubuntu.com/api/qml/sdk-14.10/QtQml.qtqml-modules-cppplugins/">documentation</a>. The
plugin is in the <code class="docutils literal"><span class="pre">PointCloud.cpp</span></code> file as a new class extending
<a class="reference external" href="http://doc.qt.io/qt-5/qqmlextensionplugin.html">QQmlExtensionPlugin</a>.  As said before, we used the QML scene graph to
display openGL under QML. As explained in the tutorial, we had to
separate the PointCloud, which lives in the GUI thread, and the
PointCloudRenderer, which lives in the rendering thread.  When the
<code class="docutils literal"><span class="pre">beforeRendering</span></code> signal from the window is emitted , at the start
of every frame before the window rendering, any OpenGL draw calls that
are made as a response to this signal will stack under the Qt Quick
items. We then simply connect the <code class="docutils literal"><span class="pre">beforeRendering</span></code> signal to the
renderer paint function to paint the PointCloud.</p>
</div>
<div class="section" id="communication-between-qml-and-the-plugin">
<h2>3.3.5.3. Communication between QML and the plugin<a class="headerlink" href="#communication-between-qml-and-the-plugin" title="Permalink to this headline">¶</a></h2>
<p>With our plugin, you can either communicate by directly calling C++
function from QML, or by dynamically setting attribute in QML. We
implemented both ways of communication :</p>
<ul class="simple">
<li>You can set in the QML PointCloud object a path to a ply file used
for the rendering. The communication is not made directly from QML
to the renderer, you have to use the PointCloud to communicate.  To
set the ply path, we added a setter and a getter, and also a <a class="reference external" href="http://doc.qt.io/qt-5/properties.html">Qt
property</a> in order to make QML aware on how to set and get the
attribute.</li>
<li>You can call directly from QML the nextCam function. To do that, you
also have to go through the point cloud object and not directly call
the renderer function. You have to add a <a class="reference external" href="https://qt-project.org/search/tag/q_invokable">Qt invokable</a> function
which calls the renderer function.</li>
</ul>
<p>Note that you really have to be aware of the whole logic behind the
scene graph in order to synchronize everything. You especially have to
use the QQuickItem function like <code class="docutils literal"><span class="pre">sync</span></code> to be able to stack the
openGL calls under the Qt Quick item.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../code.html" class="btn btn-neutral float-right" title="4. Code Documentation">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reconstruction_manager.html" class="btn btn-neutral" title="3.3.4. Reconstruction Manager"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Matthias Benkort, Nicolas Gaborit, Arthur Manoha, Matthieu Pizenberg, Louis Viot.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>