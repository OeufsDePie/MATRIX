

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.3.2. Picture Manager &mdash; MATRIX 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="MATRIX 0.1 documentation" href="../../index.html"/>
        <link rel="up" title="3.3. Components implementation" href="../components_detail.html"/>
        <link rel="next" title="3.3.3. Workspace Manager" href="workspace_manager.html"/>
        <link rel="prev" title="3.3.1. Picture Fetcher" href="picture_fetcher.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> MATRIX</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../context.html">1. Context and Objectives</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../context.html#on-set-special-effects">1.1. On-set special effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../context.html#current-solution">1.2. Current solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../context.html#objectives-of-the-application">1.3. Objectives of the application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user.html">2. Use of the Application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user/workspaces.html">2.1. Managing workspaces and scenes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/photos.html">2.2. Managing the photo selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/camera.html">2.3. Camera connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/3d.html">2.4. 3D Reconstruction and Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user/map.html">2.5. Map localization</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../architecture.html">3. Architecture of the Application</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../components_global.html">3.1. Global architecture of the application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model_view.html">3.2. The model / view pattern</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../components_detail.html">3.3. Components implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">4. Code Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../code/modules.html">4.1. MatrixGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code/Python/modules.html">4.2. Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code/PyQt/modules.html">4.3. PyQt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../doc.html">5. Building that Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../doc.html#sphinx-installation">5.1. Sphinx Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc.html#initialize-the-documentation">5.2. Initialize the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc.html#configuration-of-sphinx-documentation">5.3. Configuration of Sphinx documentation</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">MATRIX</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../architecture.html">3. Architecture of the Application</a> &raquo;</li>
      
          <li><a href="../components_detail.html">3.3. Components implementation</a> &raquo;</li>
      
    <li>3.3.2. Picture Manager</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/architecture/components_detail/picture_manager.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="picture-manager">
<h1>3.3.2. Picture Manager<a class="headerlink" href="#picture-manager" title="Permalink to this headline">¶</a></h1>
<p>This section describes several things that, once combined, allow the application to manage pictures. Models, entities and manager will be described. We&#8217;ll also write a bit about the storage system.</p>
<div class="section" id="picture-model">
<h2>3.3.2.1. Picture model<a class="headerlink" href="#picture-model" title="Permalink to this headline">¶</a></h2>
<p>In order to manipulate pictures in the <em>Picture Manager</em>, we&#8217;ve defined a specific model in Python. Besides, this model is also used by the <em>Workspace Manager</em> and the <em>Map Viewer</em> as they share common needs that may be represented into one single model. Concretly our Python implementation is classic Python class that inherit from the <a class="reference external" href="http://doc.qt.io/qt-5/qabstractlistmodel.html">QAbstractListModel</a> of Qt (or more exactly, the PyQt5 representation). Then, the model is
implementing required methods to access data, set data and easily manipulate rows. We&#8217;ve strictly respected Qt documentation and headers to write functions content; thus, Qt&#8217;s doc could be used to describe each implemented function. There is also a bunch of fonctionalities needed for our typical application purpose such as specific accessors or hydratation method.</p>
<p>Also, the picture is implementing a <em>METAClass</em> <em>Savable</em> that allow it to be stored and loaded by the <em>Workspace Manager</em> into and from the workspace. This is possible with only four methods calls on an instance of the model, which are : serialize, unserialize, save and load. Their meanings are pretty straightforward.</p>
</div>
<div class="section" id="picture-model-s-items-picture">
<h2>3.3.2.2. Picture model&#8217;s items : Picture<a class="headerlink" href="#picture-model-s-items-picture" title="Permalink to this headline">¶</a></h2>
<p>Each model is a kind of container that store certain kind of item. In our case, those items are pictures, or at least, our idea of a picture. In Matrix, a picture represent several things : a path to an image file, a name, a status, a latitude, a longitude, a date of creation, a color and an icon. All those attributes are called <em>roles</em> in the Qt world. Some of them could be directly obtained from another (color and icon from status for instance) and thus, they are just programming sugars.
However, most of the role are straightforward, except maybe the status role which we&#8217;ll describe below.</p>
<a class="reference internal image-reference" href="../../_images/schemaPictures.png"><img alt="../../_images/schemaPictures.png" class="align-center" src="../../_images/schemaPictures.png" style="width: 70%;" /></a>
<p>Thereby, a picture can have a status. The actual goal of this status is either to know which pictures to select for a reconstruction, or either to inform users about how the application is considering the picture. A picture can start in only two states : <strong>THUMBNAIL</strong> or <strong>NEW</strong>; <strong>THUMBNAIL</strong> after an import from a camera, and new after either an import from a computer, or a real import from thumbnail into HQ pictures. After a reconstruction, pictures can be in the state <strong>PROCESSED</strong> or <strong>REJECTED</strong> depending of the result of the openMVG computes. Only <strong>NEW</strong> and <strong>PROCESSED</strong> pictures are taken for a reconstruction. During the reconstruction, they are in the state <strong>RECONSTRUCTION</strong>. Finally, pictures can be manually discarded to go in the state <strong>DISCARDED</strong>. It allows user to discard thumbnail he doesn&#8217;t want to import, or to discard photos that should not be used for the reconstruction, even if they are ready.
Also, GPS coordinates of a picture are obtained from the EXIF data of a picture, using a python implementation of the tool <a class="reference external" href="http://www.sno.phy.queensu.ca/~phil/exiftool/">exiftool</a>.</p>
</div>
<div class="section" id="id1">
<h2>3.3.2.3. Picture manager<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>It is really common that the model and the model manager are gathered into one single component. The model is a specific component that holds data and gives simple accessors on those data. A manager, is typically another component that supplies high-level methods to manipulate and retrieve data from the model. When models are quite simple, they may be fusionned with the manager. As a result, it is almost our case.</p>
<p>In the application, we&#8217;ve define a manager as an upper layer, upon the model described previously. What we called manager is a <a class="reference external" href="http://doc.qt.io/qt-5/qsortfilterproxymodel.html">QSortFilterProxyModel</a>, and this is the component supplied to the different <a class="reference external" href="http://doc.qt.io/qt-5/qtqml-index.html">QML</a> views.
This manager allow us to create proxy model, i.e. models that are subsets from our real model. The main purpose is to have an easy control on sorting and filtering element inside the model. As we defined several states for each pictures, they could be filtered using this state. Thus, instead of instanciating a new model each time a filter is required, we use a proxy model that re-use the real model and simplify a part of the work.
Therefore, some accessors are directly defined on the manager to allow QML&#8217;s component to retrieve some information directly from the model, without emitting a slot.</p>
<p>Also, we&#8217;ve experimented some issues using the proxy model. Indeed, re-instantiating a proxy model to replace an existing one in the QML&#8217;s side causes a core dumped. The reason is still unknown. In order to change the source model, you would rather use appropriate method of the proxy model.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="workspace_manager.html" class="btn btn-neutral float-right" title="3.3.3. Workspace Manager">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="picture_fetcher.html" class="btn btn-neutral" title="3.3.1. Picture Fetcher"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Matthias Benkort, Nicolas Gaborit, Arthur Manoha, Matthieu Pizenberg, Louis Viot.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>